<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Booking</title>
<style>
body {
    background-color: #007BFF;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 50px 20px;
}
form {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 400px;
    background: rgba(255,255,255,0.1);
    padding: 30px;
    border-radius: 10px;
}
input, select, button {
    padding: 12px;
    margin: 10px 0;
    border-radius: 5px;
    border: none;
    font-size: 16px;
    width: 100%;
}
button {
    background-color: white;
    color: #007BFF;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
}
button:hover {
    background-color: #e6e6e6;
}
#message p {
    font-weight: bold;
    margin-top: 15px;
}
</style>
</head>
<body>
<h1>Book Your Class</h1>
<form id="bookingForm">
    <input type="text" id="name" placeholder="Your Name" required>
    <input type="email" id="email" placeholder="Your Email" required>
    <select id="day" required>
        <option value="">Select Day</option>
        <option value="Monday">Monday</option>
        <option value="Tuesday">Tuesday</option>
        <option value="Wednesday">Wednesday</option>
        <option value="Thursday">Thursday</option>
        <option value="Friday">Friday</option>
    </select>
    <select id="time" required>
        <option value="">Select Time</option>
    </select>
    <button type="submit">Book</button>
</form>

<div id="message"></div>

<script>
const form = document.getElementById('bookingForm');
const daySelect = document.getElementById('day');
const timeSelect = document.getElementById('time');
const messageDiv = document.getElementById('message');

const allSlots = ['09:00','11:00','14:00','16:00'];

daySelect.addEventListener('change', async () => {
    const day = daySelect.value;
    timeSelect.innerHTML = '<option value="">Select Time</option>';
    if(!day) return;
    try {
        const res = await fetch(/available/${day});
        const slots = await res.json();
        slots.forEach(s => {
            const option = document.createElement('option');
            option.value = s;
            option.textContent = s;
            timeSelect.appendChild(option);
        });
    } catch {
        allSlots.forEach(s => {
            const option = document.createElement('option');
            option.value = s;
            option.textContent = s;
            timeSelect.appendChild(option);
        });
    }
});

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const data = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        day: document.getElementById('day').value,
        time: document.getElementById('time').value
    };
    try {
        const res = await fetch('/book', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        const result = await res.json();
        if(res.ok){
            messageDiv.innerHTML = <p style="color:lightgreen">${result.message}</p>;
            daySelect.dispatchEvent(new Event('change'));
        } else {
            messageDiv.innerHTML = <p style="color:red">${result.error}</p>;
        }
    } catch {
        messageDiv.innerHTML = <p style="color:yellow">Server unreachable</p>;
    }
});
</script>
</body>
</html>